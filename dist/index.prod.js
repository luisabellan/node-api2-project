"use strict";var express=require("express"),cors=require("cors"),router=express.Router(),postsRoutes=require("./posts/postsRoutes"),posts=require("./data/db"),server=express();server.use(express.json()),server.use(cors()),server.get("/",function(t,s){return s.status(200).send("API up and running!")}),server.post("/api/posts",function(t,s){if(!t.body.title||!t.body.contents)return s.status(400).json({errorMessage:"Please provide title and contents for the post."});posts.insert(t.body).then(function(t){s.status(201).json(t)}).catch(function(t){return console.log(t),s.status(500).json({error:"There was an error while saving the post to the database"})})}),server.post("/api/posts/:id/comments",function(t,s){console.log(t.params.id);var e=t.params.id;if(t.body.post_id=e,!t.body.text)return s.status(400).json({errorMessage:"Please provide text for the comment."});if(0===posts.findPostComments(t.body.post_id).length)return s.status(404).json({message:"The post with the specified ID does not exist."});try{posts.insertComment(t.body).then(function(t){return s.status(201).json(t)}).catch(function(t){s.status(404).json({message:"The post with the specified ID does not exist."})})}catch(t){return console.log(t),s.status(500).json({error:"There was an error while saving the comment to the database"})}}),server.get("/api/posts",function(t,s){posts.find().then(function(t){s.status(200).json(t)}).catch(function(t){return console.log(t),s.status(500).json({error:"The posts information could not be retrieved."})})}),server.get("/api/posts/:id",function(t,s){posts.findById(t.params.id).then(function(t){return 0===t.length?s.status(404).json({message:"The post with the specified ID does not exist."}):s.status(200).json(t)}).catch(function(t){return console.log(t),s.status(500).json({error:"The post information could not be retrieved."})})}),server.get("/api/posts/:id/comments",function(t,s){posts.findCommentById(t.params.id).then(function(t){return 0===t.length?s.status(404).json({message:"The post with the specified ID does not exist."}):s.status(200).json(t)}).catch(function(t){return console.log(t),s.status(500).json({error:"The comments information could not be retrieved."})})}),server.delete("/api/posts/:id",function(t,s){posts.findById(t.params.id).then(function(t){if(0===t.length)return s.status(404).json({message:"The post with the specified ID does not exist."})}),posts.remove(t.params.id).then(function(t){s.status(204).json()}).catch(function(t){s.status(500).json({error:"The post could not be removed"})})}),server.put("/api/posts/:id",function(t,s){if(!t.body.title||!t.body.contents)return s.status(400).json({errorMessage:"Please provide title and contents for the post."});posts.findById(t.params.id).then(function(t){if(0===t.length)return s.status(404).json({message:"The post with the specified ID does not exist."})}).catch(function(t){console.log(t)}),posts.update(t.params.id,t.body).then(function(t){return console.log(s),s.status(200).json(t)}).catch(function(t){return console.log(t),s.status(500).json({error:"The post information could not be modified."})})}),server.listen(8e3,function(){return console.log("API running on port 8000")});